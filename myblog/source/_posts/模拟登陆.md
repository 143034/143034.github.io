---
title: 模拟登陆
date: 2020-05-03 14:04:40
tags:
- scrapy
categories:
- scrapy

---


# 一、概念 #




> 大部分网站都具有用户登录功能，其中某些网站只有在用户登录后才能获得有价值的信息，在爬取这类网站时，Scrapy爬虫程序需要先模拟用户登录，再爬取内容。
# 二、使用 #
## 2.1、使用FormRequest ##
     fd={'_formkey': '432dcb0c-0d85-443f-bb50-9644cfeb2f2b',
    '_formname': 'login',
    '_next': '/',
    'email': 'liushuo@webscraping.com',
    'password': '12345678'}
    from scrapy.http import FormRequest
    request = FormRequest('http://example.webscraping.com/user/login', formdata=fd)

## 2.2、调用FormRequest的from_response方法 ##
 
调用时需传入一个Response对象作为第一个参数，该方法会解析Response对象所包含页面中的form元素，帮助用户创建FormRequest对象并将隐藏input中的信息自动填入表单数据。

    from scrapy.http import FormRequest
    fd = {'email': 'liushuo@webscraping.com', 'password': '12345678'}
    request = FormRequest.from_response(response, formdata=fd)


# 三、验证码识别 #

## 3.1、ocr识别 ##


### 安装 ###
    sudo apt-get install tesseract-ocr
    pip install pillow
    pip install pytesseract

### 识别方法 ###
    from PIL import Image
    import pytesseract
    img = Image.open('code.png')
    img = img.convert('L')
    pytesseract.image_to_string(img)
    'cqKE'
## 3.2、人工识别 ##
    def get_captcha_by_user(self, data):

        img = Image.open(BytesIO(data))
        img.show()
        captcha = input('输入验证码:')
        img.close()
        return captcha