---
title: 下载管道
date: 2020-05-02 16:31:30
tags: 
- scrapy
- 管道
categories:
- scrapy

---

# 一、概念 #


> 我们可以将这两个Item Pipeline看作特殊的下载器，用户使用时只需要通过item的一个特殊字段将要下载文件或图片的url传递给它们，它们会自动将文件或图片下载到本地，并将下载结果信息存入item的另一个特殊字段，以便用户在导出文件中查阅。

![下载管道](/images/pipeline/pipeline.png)

# 二、FilesPipeline使用方法 #
## 1、在配置文件settings.py中启用FilesPipeline，通常将其置于其他Item Pipeline之前。 ##
    ITEM_PIPELINES = {'scrapy.pipelines.files.FilesPipeline': 1}


## 2、在配置文件settings.py中，使用FILES_STORE指定文件下载目录。 ##
    FILES_STORE = '/home/liushuo/Download/scrapy'

## 3、将所有需要下载文件的url地址收集到一个列表，赋给item的file_urls字段（item['file_urls']）。FilesPipeline在处理每一项item时，会读取item['file_urls']，对其中每一个url进行下载 ##

    item['file_urls'] = [url]

    当FilesPipeline下载完item['file_urls']中的所有文件后，会将各文件的下载结果信息收集到另一个列表，赋给item的files字段（item['files']）,下载结果信息包括以下内容：
    1、Path文件下载到本地的路径（相对于FILES_STORE的相对路径）。
    2、Checksum文件的校验和。
    3、url文件的url地址。


# 三、ImagesPipeline使用方法 #


## 1、在配置文件settings.py中启用ImagesPipeline，通常将其置于其他Item Pipeline之前。 ##
    ITEM_PIPELINES = {'scrapy.pipelines.images.ImagesPipeline': 1,}


## 2、在配置文件settings.py中，使用IMAGES_STORE指定文件下载目录。 ##
    IMAGES_STORE = 'download_images'

## 3、将所有需要下载文件的url地址收集到一个列表，赋给item的image_urls字段（item['image_urls']）。ImagesPipeline在处理每一项item时，会读取item['image_urls']，对其中每一个url进行下载 ##

    item['image_urls'] = [url]


## 为图片生成缩略图 ##

    下载一张图片时，本地会出现3张图片（1张原图片，2张缩略图）

    在配置文件settings.py中设置IMAGES_THUMBS：
        IMAGES_THUMBS = {
        'small': (50, 50),
        'big': (270, 270),
        }
## 过滤掉尺寸过小的图片 ##

    在配置文件settings.py中设置IMAGES_MIN_WIDTH和IMAGES_MIN_HEIGHT，它们分别指定图片最小的宽和高

    IMAGES_MIN_WIDTH = 110
    IMAGES_MIN_HEIGHT = 110



