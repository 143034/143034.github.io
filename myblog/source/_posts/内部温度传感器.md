---
title: 内部温度传感器
date: 2020-08-10 14:34:35
tags:
- stm32
categories:
- 单片机
- stm32

---

# 一、介绍 #

## 内部温度传感器框图 ##

![内部温度传感器框图](/images/单片机/stm32/内部温度传感器/内部温度传感器框图.png)

**STM32有一个内部的温度传感器，可以用来测量CPU及周围的温度(TA)。**

**该温度传感器在内部和ADCx_IN16输入通道相连接，此通道把传感器输出的电压转换成数字值。**

**温度传感器模拟输入推荐采样时间是17.1μs。**

**STM32的内部温度传感器支持的温度范围为：-40~125度。精度比较差，为±1.5℃左右。**

**内部温度传感器更适合于检测温度的变化，而不是测量绝对温度。如果需要测量绝度温度，应该使用一个外部温度传感器。**


## ADC通道和引脚对应关系 ##

![STM32F10x系列芯片ADC通道和引脚对应关系](/images/单片机/stm32/内部温度传感器/STM32F10x系列芯片ADC通道和引脚对应关系.png)


## 内部温度传感器使用注意事项 ##


- **第一个地方**，我们要使用STM32的内部温度传感器，必须先激活ADC的内部通道，这里通过ADC_CR2的TSVREFE位（bit23）设置。设置该位为1则启用内部温度传感器。

![TSVREFE位](/images/单片机/stm32/内部温度传感器/TSVREFE位.png)



- **第二个地方**，STM32的内部温度传感器固定的连接在ADC的通道16上，所以，我们在设置好ADC之后只要读取通道16的值，就是温度传感器返回来的电压值了。

根据这个值，我们就可以计算出当前温度。**计算公式如下**：

	T（℃）={（V25-Vsense）/Avg_Slope}+25
	上式中：
	V25=Vsense在25度时的数值（典型值为：1.43）。
	Avg_Slope=温度与Vsense曲线的平均斜率（单位为mv/℃或uv/℃）（典型值为4.3Mv/℃）。

**利用以上公式，我们就可以方便的计算出当前温度传感器的温度了。**



## 内部温度传感器温度和电压关系图 ##


![内部温度传感器温度和电压关系图](/images/单片机/stm32/内部温度传感器/内部温度传感器温度和电压关系图.png)



# 二、开启内部温度传感器步骤 #


- **选择ADC_IN16输入通道。**
- **设置采样时间大于17.1us**
- **设置ADC_CR2的TSVREFE位，打开内部温度传感器**
- **设置ADON位启动转换**
- **读取ADC结果**
- **计算。**



# 三、代码 #



	u16 T_Get_Adc(u8 ch)   
		{
	 
		ADC_RegularChannelConfig(ADC1, ch, 1, ADC_SampleTime_239Cycles5 );	//ADC1,通道，转换，间隔		    
	 
		ADC_SoftwareStartConvCmd(ADC1, ENABLE);		//使能软件转换
		while(!ADC_GetFlagStatus(ADC1, ADC_FLAG_EOC ));//等待转换结束
		return ADC_GetConversionValue(ADC1);	//获取值
		}
	
	u16 T_Get_Temp(void)
		{
		u16 temp_val=0;
		u8 t;
		for(t=0;t<10;t++)
			{
			temp_val+=T_Get_Adc(ADC_Channel_16);	  //TampSensor
			delay_ms(5);
			}
		return temp_val/10;
		}
	
	 //取平均
	u16 T_Get_Adc_Average(u8 ch,u8 times)
	{
		u32 temp_val=0;
		u8 t;
		for(t=0;t<times;t++)
		{
			temp_val+=T_Get_Adc(ch);
			delay_ms(5);
		}
		return temp_val/times;
	} 	   