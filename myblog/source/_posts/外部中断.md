---
title: 外部中断
date: 2020-07-29 11:03:44
tags: 
- stm32
categories:
- 单片机
- stm32

---

# 一、外部中断概述 #


**STM32的每个IO都可以作为外部中断输入。**

**STM32的中断控制器支持19个外部中断/事件请求**：

线0~15：对应外部IO口的输入中断。

线16：连接到PVD输出。

线17：连接到RTC闹钟事件。

线18：连接到USB唤醒事件。

**每个外部中断线可以独立的配置触发方式（上升沿，下降沿或者双边沿触发），触发/屏蔽，专用的状态位。**


# 二、中断线跟io口对应 #

![外部中断通用IO口映像](/images/单片机/stm32/外部中断/外部中断通用IO口映像.png)

	
	GPIOx.0映射到EXTI0
	GPIOx.1映射到EXTI1
	…
	GPIOx.15映射到EXTI15

**对于每个中断线，我们可以设置相应的触发方式（上升沿触发，下降沿触发，边沿触发）以及使能。**

**IO口外部中断在中断向量表中只分配了7个中断向量，也就是只能使用7个中断服务函数**


![中断服务函数](/images/单片机/stm32/外部中断/中断服务函数.png)

从表中可以看出，**外部中断线5~9分配一个中断向量，共用一个服务函数,外部中断线10~15分配一个中断向量，共用一个中断服务函数。**


## 中断服务函数列表： ##

	EXTI0_IRQHandler           
	EXTI1_IRQHandler
	EXTI2_IRQHandler           
	EXTI3_IRQHandler           
	EXTI4_IRQHandler           
	EXTI9_5_IRQHandler         
	EXTI15_10_IRQHandler       



# 三、外部中断常用库函数 #

	void GPIO_EXTILineConfig(uint8_t GPIO_PortSource, uint8_t GPIO_PinSource);
	//设置IO口与中断线的映射关系
	
	exp:  GPIO_EXTILineConfig(GPIO_PortSourceGPIOE,GPIO_PinSource2);
	
	void EXTI_Init(EXTI_InitTypeDef* EXTI_InitStruct);
	//初始化中断线：触发方式等
	
	ITStatus EXTI_GetITStatus(uint32_t EXTI_Line);
	//判断中断线中断状态，是否发生
	
	void EXTI_ClearITPendingBit(uint32_t EXTI_Line);
	//清除中断线上的中断标志位



# 四、EXTI_Init函数 #


> void EXTI_Init(EXTI_InitTypeDef* EXTI_InitStruct)；
	
	typedef struct
	{
	  uint32_t EXTI_Line;   //指定要配置的中断线           
	  EXTIMode_TypeDef EXTI_Mode;   //模式：事件 OR中断
	  EXTITrigger_TypeDef EXTI_Trigger;//触发方式：上升沿/下降沿/双沿触发
	  FunctionalState EXTI_LineCmd;  //使能 OR失能
	}EXTI_InitTypeDef;
	
	
	 EXTI_InitStructure.EXTI_Line=EXTI_Line2;	 
	 EXTI_InitStructure.EXTI_Mode = EXTI_Mode_Interrupt;	
	 EXTI_InitStructure.EXTI_Trigger = EXTI_Trigger_Falling;
	 EXTI_InitStructure.EXTI_LineCmd = ENABLE;
	 EXTI_Init(&EXTI_InitStructure);	



# 5、外部中断的一般配置步骤： #

**1. 初始化IO口为输入。**

	GPIO_Init();

**2. 开启IO口复用时钟。**

	RCC_APB2PeriphClockCmd(RCC_APB2Periph_AFIO,ENABLE);

**3. 设置IO口与中断线的映射关系。**

	void GPIO_EXTILineConfig();

**4. 初始化线上中断，设置触发条件等。**

	EXTI_Init();

**5. 配置中断分组（NVIC），并使能中断。**

	NVIC_Init();

**6. 编写中断服务函数。**

	EXTIx_IRQHandler();

**7. 清除中断标志位**

	EXTI_ClearITPendingBit();

# 六、配置代码: #


	EXTI_InitTypeDef EXTI_InitStructure;
	NVIC_InitTypeDef NVIC_InitStructure;
	RCC_APB2PeriphClockCmd(RCC_APB2Periph_AFIO,ENABLE);
	GPIO_EXTILineConfig(GPIO_PortSourceGPIOC,GPIO_PinSource5);
	
	EXTI_InitStructure.EXTI_Line=EXTI_Line5;
	EXTI_InitStructure.EXTI_Mode = EXTI_Mode_Interrupt;	
	EXTI_InitStructure.EXTI_Trigger = EXTI_Trigger_Falling;
	EXTI_InitStructure.EXTI_LineCmd = ENABLE;
	EXTI_Init(&EXTI_InitStructure);	
	NVIC_InitStructure.NVIC_IRQChannel = EXTI9_5_IRQn;		
	NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority = 0x02;	
	NVIC_InitStructure.NVIC_IRQChannelSubPriority = 0x01;				
	NVIC_InitStructure.NVIC_IRQChannelCmd = ENABLE;							
	NVIC_Init(&NVIC_InitStructure); 
	
	
	void EXTI9_5_IRQHandler(void)
	{			
		delay_ms(10);   		 
		if(KEY0==0)	{
			LED0=!LED0;
		}
	 	 EXTI_ClearITPendingBit(EXTI_Line5);   
	}