---
title: 端口复用和重映射
date: 2020-07-25 15:48:10
tags:
- stm32
categories:
- 单片机
- stm32

---

# 什么是端口复用？ #


>STM32有很多的内置外设，这些外设的外部引脚都是与GPIO复用的。也就是说，一个GPIO如果可以复用为内置外设的功能引脚，那么当这个GPIO作为内置外设使用的时候，就叫做复用。例如串口1 的发送接收引脚是PA9,PA10，当我们把PA9,PA10不用作GPIO，而用做复用功能串口1的发送接收引脚的时候，叫端口复用。

![端口复用举例](/images/单片机/stm32/端口复用举例.png)

## 端口复用配置过程-以PA9,PA10配置为串口1为例 ##

1、GPIO端口时钟使能。

    RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA, ENABLE);
2、复用外设时钟使能。

     比如你要将端口PA9,PA10复用为串口，所以要使能串口时钟。
     RCC_APB2PeriphClockCmd(RCC_APB2Periph_USART1, ENABLE);
3、端口模式配置。
 
	GPIO_Init（）函数。
	查表：《STM32中文参考手册V10》P110的表格“8.1.11外设的GPIO配置”

![模式选择](/images/单片机/stm32/模式选择.png)


## PA9,PA10复用为串口1配置过程 ##
	
	RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA, ENABLE);//①IO时钟使能
	
	RCC_APB2PeriphClockCmd(RCC_APB2Periph_USART1, ENABLE);//②外设时钟使能
	
	//③初始化IO为对应的模式
	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_9; //PA.9//复用推挽输出
	GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;
	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF_PP; 
	GPIO_Init(GPIOA, &GPIO_InitStructure);
	  
	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_10;//PA10 PA.10 浮空输入
	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_IN_FLOATING;//浮空输入
	GPIO_Init(GPIOA, &GPIO_InitStructure);  

# 什么是端口重映射？ #

> 每个内置外设都有若干个输入输出引脚，一般这些引脚的输出端口都是固定不变的，为了让设计工程师可以更好地安排引脚的走向和功能，在STM32中引入了外设引脚重映射的概念，即一个外设的引脚除了具有默认的端口外，还可以通过设置重映射寄存器的方式，把这个外设的引脚映射到其它的端口。为了使不同器件封装的外设IO功能数量达到最优，可以把一些复用功能重新映射到其他一些引脚上。STM32中有很多内置外设的输入输出引脚都具有重映射(remap)的功能。


![IO口的重映射](/images/单片机/stm32/IO口的重映射.png)

## 《STM32中文参考手册V10》的P116页“8.3复用功能和调试配置” ##

![USART1重映射](/images/单片机/stm32/USART1重映射.png)

数据手册引脚描述

![数据手册引脚描述](/images/单片机/stm32/数据手册引脚描述.png)

## 部分重映射 & 完全重映射 ##

### 部分重映射： ###

    功能外设的部分引脚重新映射，还有一部分引脚是原来的默认引脚。

### 完全重映射 ###：

	功能外设的所有引脚都重新映射。

![USART3重映射表](/images/单片机/stm32/USART3重映射表.png)




## 引脚重映射配置过程（串口1为例）： ##


	1、使能GPIO时钟（重映射后的IO);
	2、使能功能外设时钟（例如串口1);
	3、使能AFIO时钟。重映射必须使能AFIO时钟：
	     RCC_APB2PeriphClockCmd(RCC_APB2Periph_AFIO, ENABLE);
	4、开启重映射。
	    GPIO_PinRemapConfig(GPIO_Remap_USART1, ENABLE);
	根据第一个参数，来确定是部分重映射还是全部重映射



## 哪些情况需要开启AFIO辅助功能时钟？ ##

	对寄存器AFIO_MAPR，AFIO_EXTICRX和AFIO_EVCR进行读写操作前，应当首先打开AFIO时钟。
	AFIO_MAPR：配置复用功能重映射
	AFIO_EXTICRX:配置外部中断线映射
	AFIO_EVCR:   配置EVENTOUT事件输出