---
title: 通用定时器基本原理
date: 2020-08-01 23:52:32
tags: 
- stm32
categories:
- 单片机
- stm32

---

# 一、介绍 #

**STM32F10x系列总共最多有8个定时器**

![定时器数量](/images/单片机/stm32/定时器/定时器数量.png)

## 三种STM32定时器区别 ##

![定时器种类](/images/单片机/stm32/定时器/定时器种类.png)



## 通用定时器功能特点描述 ##

**STM32的通用 TIMx (TIM2、TIM3、TIM4 和 TIM5)定时器功能特点包括：**

**1. 位于低速的APB1总线上(APB1)**

**2. 16 位向上、向下、向上/向下(中心对齐)计数模式，自动装载计数器（TIMx_CNT）。**

**3. 16 位可编程(可以实时修改)预分频器(TIMx_PSC)，计数器时钟频率的分频系数 为 1～65535 之间的任意数值。**

**4. 4 个独立通道（TIMx_CH1~4），这些通道可以用来作为**

    输入捕获 
    输出比较
    PWM 生成(边缘或中间对齐模式) 
    单脉冲模式输出 

**5. 可使用外部信号（TIMx_ETR）控制定时器和定时器互连（可以用 1 个定时器控制另外一个定时器）的同步电路。**


## 中断 ##

**如下事件发生时产生中断/DMA（6个独立的IRQ/DMA请求生成器）**

**1. 更新：计数器向上溢出/向下溢出，计数器初始化(通过软件或者内部/外部触发) 。**

**2. 触发事件(计数器启动、停止、初始化或者由内部/外部触发计数)**

**3. 输入捕获。**

**4. 输出比较** 

**5. 支持针对定位的增量(正交)编码器和霍尔传感器电路**

**6. 触发输入作为外部时钟或者按周期的电流管理**

**7. STM32 的通用定时器可以被用于：测量输入信号的脉冲长度(输入捕获)或者产生输出波形(输出比较和 PWM)等。**

**8. 使用定时器预分频器和 RCC 时钟控制器预分频器，脉冲长度和波形周期可以在几个微秒到几个毫秒间调整。STM32 的每个通用定时器都是完全独立的，没有互相共享的任何资源。**



## 计数器模式 ##



**通用定时器可以向上计数、向下计数、向上向下双向计数模式。**


- 向上计数模式：计数器从0计数到自动加载值(TIMx_ARR)，然后重新从0开始计数并且产生一个计数器溢出事件。
- 向下计数模式：计数器从自动装入的值(TIMx_ARR)开始向下计数到0，然后从自动装入的值重新开始，并产生一个计数器向下溢出事件。
- 中央对齐模式（向上/向下计数）：计数器从0开始计数到自动装入的值-1，产生一个计数器溢出事件，然后向下计数到1并且产生一个计数器溢出事件；然后再从0开始重新计数。

![计数模式](/images/单片机/stm32/定时器/计数模式.png)


# 二、通用定时器工作过程 #

**工作过程**

![通用定时器工作过程](/images/单片机/stm32/定时器/通用定时器工作过程.png)



**计数时钟的选择**



![计数时钟的选择](/images/单片机/stm32/定时器/计数时钟的选择.png)


**时基单元**


![时基单元](/images/单片机/stm32/定时器/时基单元.png)




**更新事件**

![更新事件](/images/单片机/stm32/定时器/更新事件.png)


**输入捕获模式**

![输入捕获模式](/images/单片机/stm32/定时器/输入捕获模式.png)




**PWM模式**

![pwm模式](/images/单片机/stm32/定时器/pwm模式.png)




